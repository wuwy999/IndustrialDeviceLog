<Window x:Class="IndustrialDeviceLog.Views.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:IndustrialDeviceLog" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:IndustrialDeviceLog.ViewModels" Title="工业设备日志管理器" Width="800" Height="450" mc:Ignorable="d">

    <Window.DataContext>
        <viewModels:LogViewModel />
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <!--  第 1 行：表单（高度自适应）  -->
            <RowDefinition Height="Auto" />
            <!--  第 2 行：筛选（间距10）  -->
            <RowDefinition Height="Auto" />
            <!--  第 3 行：日志列表（占剩余高度）  -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  第一行       日志录入表单  -->
        <StackPanel Grid.Row="0" Margin="10" Orientation="Horizontal">
            <Label Content="设备编号：" />
            <TextBox Width="120"
                     Text="{Binding DeviceCode, UpdateSourceTrigger=PropertyChanged}" />

            <Label Content="设备类型：" />

            <ComboBox Width="100"
                      ItemsSource="{Binding DeviceTypeList}"
                      SelectedItem="{Binding SelectedDeviceType}" />

            <Label Content="运行状态：" />
            <ComboBox Width="100"
                      ItemsSource="{Binding RunStatusList}"
                      SelectedItem="{Binding SelectedRunStatus}" />

            <Label Content="日志内容：" />
            <TextBox Width="200"
                     Text="{Binding LogContent}" />
            <Button Command="{Binding SaveLogCommand}"
                    Content="保存日志" />
        </StackPanel>

        <!--  第二行      日志筛选  -->
        <StackPanel Grid.Row="1" Margin="10" Orientation="Horizontal">
            <Label Content="设备类型筛选：" />
            <ComboBox Width="100"
                      ItemsSource="{Binding DeviceTypeList}"
                      SelectedItem="{Binding SelectedDeviceType}" />

            <Label Content="时间范围：" />

            <DatePicker Width="120"
                        SelectedDate="{Binding StartDate}" />
            <Label Content="至" />
            <DatePicker Width="120"
                        SelectedDate="{Binding EndDate}" />

            <Button Command="{Binding QueryLogCommand}"
                    Content="查询日志" />

            <Button Margin="10,0,0,0"
                    Command="{Binding ExportExcelCommand}"
                    Content="导出Excel" />
        </StackPanel>

        <!--  第三行       日志列表 + 导出  -->

        <!--  列表只读，不允许编辑 [设置只读以后，尽管是偷懒绑定的是Model，也安全]  -->
        <DataGrid Grid.Row="2" AutoGenerateColumns="False" IsReadOnly="True"
                  ItemsSource="{Binding LogList}">

            <!--  手动定义列，绑定 DeviceLog 的属性  -->
            <DataGrid.Columns>
                <DataGridTextColumn Width="80"
                                    Binding="{Binding DeviceLogId}"
                                    Header="日志ID" />
                <DataGridTextColumn Width="120"
                                    Binding="{Binding DeviceCode}"
                                    Header="设备编号" />
                <DataGridTextColumn Width="100"
                                    Binding="{Binding DeviceType}"
                                    Header="设备类型" />
                <DataGridTextColumn Width="100"
                                    Binding="{Binding DeviceRunStatus}"
                                    Header="运行状态" />
                <DataGridTextColumn Width="*"
                                    Binding="{Binding DeviceLogContent}"
                                    Header="日志内容" />
                <DataGridTextColumn Width="180"
                                    Binding="{Binding DeviceLogCreatTime, StringFormat='yyyy-MM-dd HH:mm:ss'}"
                                    Header="记录时间" />
                <DataGridTemplateColumn Width="80" Header="操作">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Command="{Binding DataContext.DeleteLogCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    Content="删除" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
